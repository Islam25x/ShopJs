const data =
[
    {
        "id": 1,
        "title": "Basic Sandals",
        "price": 109.95,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "shoes",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/shoes.jpg",
        "add": "Add to cart"
    },
    {
        "id": 2,
        "title": "Lily Shirt",
        "price": 20.00,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "Shirts",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/bag2-1-600x600.jpg",
        "add": "Add to cart"
    },
    {
        "id": 3,
        "title": "Light Shoes",
        "price": 18.00,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "shoes",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/shoes2-600x600.jpg",
        "add": "Add to cart"
    },
    {
        "id": 4,
        "title": "Jeans Shorts",
        "price": 20.00,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "pants",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/shorts2-600x600.jpg",
        "add": "Add to cart"
    },
    {
        "id": 5,
        "title": "Basic Sandals",
        "price": 35.00,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "shoes",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/shoes3-600x600.jpg",
        "add": "Add to cart"
    },
    {
        "id": 6,
        "title": "Fancy Shoes",
        "price": 35.00,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "shoes",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/bag-1-600x600.jpg",
        "add": "Add to cart"
    },
    {
        "id": 7,
        "title": "Cool Hat",
        "sale": "SALE!",
        "price": 12.00,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "hats",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/hat1-600x600.jpg",
        "add": "Add to cart"
    },
    {
        "id": 8,
        "title": "Cool Glasses",
        "sale": "SALE!",
        "price": 18.00,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "glasses",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/glasses-2-600x600.jpg",
        "add": "Add to cart"
    },
    {
        "id": 9,
        "title": "Brown Shoes",
        "price": 15.00,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "shoes",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/shoes-man-1-600x600.jpg",
        "add": "Add to cart"
    },
    {
        "id": 10,
        "title": "Brown Backpack",
        "price": 15.00,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "backpack",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/bag3-600x600.jpg",
        "add": "Add to cart"
    },
    {
        "id": 11,
        "title": "Beige Shorts",
        "price": 35.00,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "pants",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/shorts1-600x600.jpg",
        "add": "Add to cart"
    },
    {
        "id": 12,
        "title": "Color Bag",
        "price": 35.00,
        "description": "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.",
        "category": "backpack",
        "image": "https://www.engage.veented.com/shop-dark/wp-content/uploads/sites/42/2013/06/bag4-600x600.jpg",
        "add": "Add to cart"
    }
] 
const container = document.getElementById('con');
const searchInput = document.getElementById('search-input');
const searchType = document.getElementById('s-type');
const logout = document.getElementById('logout');
let products = document.querySelectorAll('img')
let cart = document.getElementById('cart')
let order = document.getElementById('order')
let TotalValue = document.querySelector('.value')
let total = document.querySelector('.total')
let view = document.querySelector('.view')
let plus_itemprice = 0
let TotalPrice = 0
let arrProduct = []
let arrFav = []
let favProduct = window.localStorage.getItem('fav') 
let Sproducts = window.localStorage.getItem('products')
const user = JSON.parse(localStorage.getItem('user'));
let welcome = document.querySelector('header h3 span')
console.log(welcome);

welcome.textContent = user.name

if(arrProduct !== ''){
    proStorage()
}
view.addEventListener('click',()=>{
    window.location.href = 'product.html'
})
cart.addEventListener('click',()=>{
    if(order.style.display == 'block'){
        order.style.display = 'none'
    }
    else{
        order.style.display = 'block'
    }
})

logout.addEventListener('click',()=>{
    window.location.href = 'login.html'
})
function renderProducts(products) {
    container.innerHTML = ''; // Clear current products
    products.forEach(item => {
        let card = document.createElement('div');
        let photo = document.createElement('img');
        let card_des = document.createElement('div');
        let product = document.createElement('h6');
        let product_name = document.createElement('span');
        let price = document.createElement('h6');
        let price_con = document.createElement('span');
        let cat = document.createElement('h6');
        let cat_con = document.createElement('span');
        let card_bottom = document.createElement('div');
        let btn = document.createElement('button');
        let fav = document.createElement('img');

        // Classes
        card.classList.add('card');
        card_des.classList.add('card_des');
        card_bottom.classList.add('card_bottom', 'd-flex', 'justify-content-between');
        fav.classList.add('gray');

        // Content
        photo.src = item.image;
        product.textContent = 'product name: ';
        product_name.textContent = item.title;
        price.textContent = 'price: ';
        price_con.textContent = item.price + '$';
        cat.textContent = 'category: ';
        cat_con.textContent = item.category;
        btn.textContent = 'Add to cart';
        fav.src = 'imgs/heart-solid-gray.svg';

        // Append
        container.appendChild(card);
        card.appendChild(photo);
        card.appendChild(card_des);
        card_des.appendChild(product);
        product.appendChild(product_name);
        card_des.appendChild(price);
        price.appendChild(price_con);
        card_des.appendChild(cat);
        cat.appendChild(cat_con);
        card.appendChild(card_bottom);
        card_bottom.appendChild(btn);
        card_bottom.appendChild(fav);

        
        if(favProduct.includes(item.image)){
            fav.classList.remove('gray')
            fav.src = "imgs/heart-solid-red.svg";
            fav.classList.add('favItem')
        }
        if(Sproducts.includes(item.title)){
            console.log('wiki');
            
            btn.style.background = 'green';
            btn.textContent = 'added from cart';
            btn.disabled = true
        }
        // Event listeners for the button and favorite icon
        btn.addEventListener('click', () => {
            if (btn.style.background == 'green') {
                btn.textContent = 'Add to cart';
                btn.style.background = 'black';
            } else {
                btn.style.background = 'green';
                btn.textContent = 'added from cart';
                btn.disabled = true
                arrProduct.push(item)
                window.localStorage.setItem('products', JSON.stringify(arrProduct));
                // ........................................................
                TotalPrice += parseInt(item.price)
                total.innerHTML = `${TotalPrice}$`
                window.localStorage.setItem('total',TotalPrice)
                let list = document.createElement('li')
                let img = document.createElement('img')
                let h3 = document.createElement('h3')
                let photoDes = document.createElement('div')
                let btns = document.createElement('div')
                let plus = document.createElement('button')
                let minas = document.createElement('button')
                let p = document.createElement('p')
                let div = document.createElement('div')
                let x = document.createElement('p')
                let itemCount = document.createElement('span')
                let count = 1
                btns.classList.add('btns')
                plus.textContent = '+'
                minas.textContent = '-'
                x.textContent ='x'
                x.classList.add('x')
                div.classList.add('order')
                p.textContent = item.price+'$'
                h3.textContent = item.title
                img.src = item.image
                order.appendChild(list)
                list.appendChild(div)
                div.appendChild(img)
                photoDes.appendChild(h3)
                h3.appendChild(itemCount)
                photoDes.appendChild(btns)
                btns.appendChild(plus)
                btns.appendChild(minas)
                photoDes.appendChild(p)
                div.appendChild(photoDes)
                div.appendChild(x)
                minas.disabled = true
                minas.style.backgroundColor = '#0000009e'
        
                // Events 
                plus.addEventListener('click',()=>{
                    count ++
                    window.localStorage.setItem('count', count)
                    proCount = JSON.parse(window.localStorage.getItem('count'))
                    console.log(proCount);
                    minas.disabled = false
                    minas.style.backgroundColor = 'black'
                    itemCount.textContent = proCount
                    TotalPrice += parseInt(item.price)
                    total.innerHTML = `${TotalPrice}$`
        
                    plus_itemprice += parseInt(item.price)
                    p.innerHTML = `${ plus_itemprice + item.price}$`
                })
                minas.addEventListener('click',()=>{
                    count --
                    itemCount.textContent = count
                    if(count > 1){
                        minas.disabled = false
                        minas.style.backgroundColor = 'black'
                        
                    }
                    else{
                        minas.disabled = true
                        minas.style.backgroundColor = '#0000009e'
                    }
                    TotalPrice -= parseInt(item.price)
                    total.innerHTML = `${TotalPrice}$`
        
                    plus_itemprice -= parseInt(item.price)
                    p.innerHTML = `${plus_itemprice + item.price}$`
                })
                x.addEventListener('click',()=>{
                    btn.disabled = false
                    btn.textContent = 'Add to cart'
                    btn.style.backgroundColor = 'black'
                    div.style.display = 'none'
                    TotalPrice -= parseInt(item.price)
                    total.innerHTML = `${TotalPrice}$`
                    arrProduct = arrProduct.filter(items => items !== item);
                    window.localStorage.setItem('products', JSON.stringify(arrProduct));
                    
                })
            }
        });
        fav.addEventListener('click', () => {
            if (fav.classList.contains('gray')) {
                fav.src = "imgs/heart-solid-red.svg";
                fav.classList.add('favItem')
                fav.classList.remove('gray');
                arrFav.push(item)
                window.localStorage.setItem('fav', JSON.stringify(arrFav));

            } else {
                fav.src = "imgs/heart-solid-gray.svg";
                fav.classList.add('gray');
                arrFav = arrFav.filter(items => items !== item);
                window.localStorage.setItem('fav', JSON.stringify(arrFav));
            }
        });
    });
}

renderProducts(data);

// Filter products when typing in the search input
searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase();
    const filterBy = searchType.value;

    const filteredProducts = data.filter(item => {
        if (filterBy === 'name') {
            return item.title.toLowerCase().includes(query);
        } else if (filterBy === 'Category') {
            return item.category.toLowerCase().includes(query);
        }
        return false;
    });

    renderProducts(filteredProducts);
});

function proStorage(){
    let pros = JSON.parse(window.localStorage.getItem('products'))
    pros.forEach(e => {
        TotalPrice += parseInt(e.price)
        total.innerHTML = `${TotalPrice}$`
        window.localStorage.setItem('total',TotalPrice)
        let list = document.createElement('li')
        let img = document.createElement('img')
        let h3 = document.createElement('h3')
        let photoDes = document.createElement('div')
        let btns = document.createElement('div')
        let plus = document.createElement('button')
        let minas = document.createElement('button')
        let p = document.createElement('p')
        let div = document.createElement('div')
        let x = document.createElement('p')
        let itemCount = document.createElement('span')
        let count = 1
        btns.classList.add('btns')
        plus.textContent = '+'
        minas.textContent = '-'
        x.textContent ='x'
        x.classList.add('x')
        div.classList.add('order')
        p.textContent = e.price+'$'
        h3.textContent = e.title
        img.src = e.image
        order.appendChild(list)
        list.appendChild(div)
        div.appendChild(img)
        photoDes.appendChild(h3)
        h3.appendChild(itemCount)
        photoDes.appendChild(btns)
        btns.appendChild(plus)
        btns.appendChild(minas)
        photoDes.appendChild(p)
        div.appendChild(photoDes)
        div.appendChild(x)
        minas.disabled = true
        minas.style.backgroundColor = '#0000009e'

        
        // Events 
        plus.addEventListener('click',()=>{
            count ++
            window.localStorage.setItem('count', count)
            proCount = JSON.parse(window.localStorage.getItem('count'))
            console.log(proCount);
            minas.disabled = false
            minas.style.backgroundColor = 'black'
            itemCount.textContent = proCount
            TotalPrice += parseInt(e.price)
            total.innerHTML = `${TotalPrice}$`
            plus_itemprice += parseInt(e.price)
            p.innerHTML = `${ plus_itemprice + e.price}$`
        })
        minas.addEventListener('click',()=>{
            count --
            itemCount.textContent = count
            if(count > 1){
                minas.disabled = false
                minas.style.backgroundColor = 'black'
                
            }
            else{
                minas.disabled = true
                minas.style.backgroundColor = '#0000009e'
            }
            TotalPrice -= parseInt(e.price)
            total.innerHTML = `${TotalPrice}$`

            plus_itemprice -= parseInt(e.price)
            p.innerHTML = `${plus_itemprice + e.price}$`
        })
        x.addEventListener('click',()=>{
            div.style.display = 'none'
            TotalPrice -= parseInt(e.price)
            total.innerHTML = `${TotalPrice}$`
            arrProduct = arrProduct.filter(items => items !== e);
            window.localStorage.setItem('products', JSON.stringify(arrProduct));
            
        })
    });
}



// localStorage.clear()